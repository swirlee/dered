<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.asjy.commerplat.dao.OrderMapper" >
<resultMap id="BaseResultMap" type="com.asjy.commerplat.model.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
    <result column="userid" property="userid" jdbcType="INTEGER" />
    <result column="ordernumber" property="ordernumber" jdbcType="VARCHAR" />
    <result column="cityaddress" property="cityaddress" jdbcType="VARCHAR" />
    <result column="detailaddress" property="detailaddress" jdbcType="VARCHAR" />
    <result column="receiver" property="receiver" jdbcType="VARCHAR" />
    <result column="tel" property="tel" jdbcType="VARCHAR" />
    <result column="zipcode" property="zipcode" jdbcType="VARCHAR" />
    <result column="orderstate" property="orderstate" jdbcType="VARCHAR" />
    <result column="totalprice" property="totalprice" jdbcType="DECIMAL" />
 </resultMap>   
 
  <resultMap id="BaseResultMap2" type="com.asjy.commerplat.model.Order" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
    <result column="userid" property="userid" jdbcType="INTEGER" />
    <result column="ordernumber" property="ordernumber" jdbcType="VARCHAR" />
    <result column="cityaddress" property="cityaddress" jdbcType="VARCHAR" />
    <result column="detailaddress" property="detailaddress" jdbcType="VARCHAR" />
    <result column="receiver" property="receiver" jdbcType="VARCHAR" />
    <result column="tel" property="tel" jdbcType="VARCHAR" />
    <result column="zipcode" property="zipcode" jdbcType="VARCHAR" />
    <result column="orderstate" property="orderstate" jdbcType="VARCHAR" />
    <result column="totalprice" property="totalprice" jdbcType="DECIMAL" />
     <association property="user" javaType="com.asjy.commerplat.model.User">
		<id column="uid" property="id" jdbcType="INTEGER" />
 		<result column="username" property="username" jdbcType="VARCHAR" />
	</association>
    <collection property="list_detailorder" ofType="com.asjy.commerplat.model.Detailorder">
    	<id column="detailorderid" property="id" jdbcType="INTEGER" />
	    <result column="goodsid" property="goodsid" jdbcType="INTEGER" />
	    <result column="orderid" property="orderid" jdbcType="INTEGER" />
	    <result column="price" property="price" jdbcType="DECIMAL" />
	    <result column="count" property="count" jdbcType="INTEGER" />
	    <result column="subtotal" property="subtotal" jdbcType="DECIMAL" />
	    	<association property="goods" javaType="com.asjy.commerplat.model.Goods">
	    		<id column="gid" property="id" jdbcType="INTEGER" />
			    <result column="goodsname" property="goodsname" jdbcType="VARCHAR" />
			    <result column="classid" property="classid" jdbcType="INTEGER" />
			    <result column="brandid" property="brandid" jdbcType="INTEGER" />
			    <result column="sellprice" property="sellprice" jdbcType="DECIMAL" />
			    <result column="originalprice" property="originalprice" jdbcType="DECIMAL" />
			    <result column="Inventory" property="inventory" jdbcType="INTEGER" />
			    <result column="salevolume" property="salevolume" jdbcType="INTEGER" />
			    <result column="clicks" property="clicks" jdbcType="INTEGER" />
			    <result column="path" property="path" jdbcType="VARCHAR" />
			    <result column="volume" property="volume" jdbcType="DECIMAL" />
			    <result column="weight" property="weight" jdbcType="DECIMAL" />
			    <result column="goodsnumber" property="goodsnumber" jdbcType="VARCHAR" />
	    	</association>
    </collection>
   
  </resultMap>
  
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, addtime, userid, ordernumber, cityaddress, detailaddress, receiver, tel, zipcode, 
    orderstate, totalprice
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_order
    where id = #{id,jdbcType=INTEGER}
    and orderstate != "用户看不到"
  </select>
  
  
  
  <select id="getMonth" resultType="map">
  
    select 
    IFNULL(sum(case month(addtime) when '1' then totalPrice else 0 end), 0) as '1',
	IFNULL(SUM(CASE month(addtime) WHEN '2' then totalprice else 0 end), 0) as '2',
	IFNULL(SUM(CASE month(addtime) WHEN '3' then totalprice else 0 end), 0) as '3',
	IFNULL(SUM(CASE month(addtime) WHEN '4' then totalprice else 0 end), 0) as '4',
	IFNULL(SUM(CASE month(addtime) WHEN '5' then totalprice else 0 end), 0) as '5',
	IFNULL(SUM(CASE month(addtime) WHEN '6' then totalprice else 0 end), 0) as '6',
	IFNULL(SUM(CASE month(addtime) WHEN '7' then totalprice else 0 end), 0) as '7',
	IFNULL(SUM(CASE month(addtime) WHEN '8' then totalprice else 0 end), 0) as '8',
	IFNULL(SUM(CASE month(addtime) WHEN '9' then totalprice else 0 end), 0) as '9',
	IFNULL(SUM(CASE month(addtime) WHEN '10' then totalprice else 0 end), 0) as '10',
	IFNULL(SUM(CASE month(addtime) WHEN '11' then totalprice else 0 end), 0) as '11',
	IFNULL(SUM(CASE month(addtime) WHEN '12' then totalprice else 0 end), 0) as '12'
	FROM tb_order where year(addtime) = '2018'
	
  </select>
  
  
  <select id="selectByPrimaryKey_back" resultMap="BaseResultMap2" >
    select 
    ord.id, ord.addtime, ord.userid, ord.ordernumber, ord.cityaddress, ord.detailaddress, ord.receiver, ord.tel, ord.zipcode, 
    ord.orderstate, ord.totalprice, 
    detailorder.id as detailorderid, detailorder.goodsid, detailorder.orderid, detailorder.price, detailorder.count, detailorder.subtotal,
    goods.id as gid, goods.addtime, goods.goodsname, goods.classid, goods.brandid, goods.sellprice, goods.originalprice, goods.Inventory, goods.salevolume, 
    goods.clicks, goods.state, goods.path, goods.volume, goods.weight, goods.goodsnumber, goods.recommend,
    user.id as uid, user.username
     from tb_order ord
    left join tb_detailorder detailorder on detailorder.orderid = ord.id
    left join tb_goods goods on goods.id = detailorder.goodsid
    left join tb_user user on user.id = ord.userid
    where ord.id = #{id}
    order by ord.addtime desc
  </select>
    
  <select id="findAll" resultMap="BaseResultMap2">
    select 
    ord.id, ord.addtime, ord.userid, ord.ordernumber, ord.cityaddress, ord.detailaddress, ord.receiver, ord.tel, ord.zipcode, 
    ord.orderstate, ord.totalprice, 
    detailorder.id as detailorderid, detailorder.goodsid, detailorder.orderid, detailorder.price, detailorder.count, detailorder.subtotal,
    goods.id as gid, goods.addtime, goods.goodsname, goods.classid, goods.brandid, goods.sellprice, goods.originalprice, goods.Inventory, goods.salevolume, 
    goods.clicks, goods.state, goods.path, goods.volume, goods.weight, goods.goodsnumber, goods.recommend,
    user.id as uid, user.username
    from tb_order ord
    left join tb_detailorder detailorder on detailorder.orderid = ord.id
    left join tb_goods goods on goods.id = detailorder.goodsid
    left join tb_user user on user.id = ord.userid
	<if test="ordernumber != null and ordernumber != ''">
     and ord.ordernumber = #{ordernumber}
    </if>
    <if test="begintime != null and begintime != ''" >
     and ord.addtime &gt;= #{begintime}
    </if>
    <if test="endtime != null and endtime != ''" >
     and ord.addtime &lt;= "${endtime} 23:59:59"
    </if>
    <if test="orderstate != null and orderstate != ''" >
     and ord.orderstate = #{orderstate}
    </if>
    order by ord.addtime desc
  </select>
  
  <select id="selectByOrdernumber" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from tb_order
    where ordernumber = #{ordernumber}
    and orderstate != "用户看不到"
  </select>
  
  
  
    <select id="selectByUserid" resultMap="BaseResultMap2">
    select 
    ord.id, ord.addtime, ord.userid, ord.ordernumber, ord.cityaddress, ord.detailaddress, ord.receiver, ord.tel, ord.zipcode, 
    ord.orderstate, ord.totalprice, 
    detailorder.id as detailorderid, detailorder.goodsid, detailorder.orderid, detailorder.price, detailorder.count, detailorder.subtotal,
    goods.id as gid, goods.addtime, goods.goodsname, goods.classid, goods.brandid, goods.sellprice, goods.originalprice, goods.Inventory, goods.salevolume, 
    goods.clicks, goods.state, goods.path, goods.volume, goods.weight, goods.goodsnumber, goods.recommend
    from tb_order ord
    left join tb_detailorder detailorder on detailorder.orderid = ord.id
    left join tb_goods goods on goods.id = detailorder.goodsid
    where ord.userid = #{userid}
    and ord.orderstate != "用户看不到"
	<if test="ordernumber != null and ordernumber != ''">
     and ord.ordernumber = #{ordernumber}
    </if>
    <if test="begintime != null and begintime != ''" >
     and ord.addtime &gt;= #{begintime}
    </if>
    <if test="endtime != null and endtime != ''" >
     and ord.addtime &lt;= "${endtime} 23:59:59"
    </if>
    <if test="orderstate != null and orderstate != ''" >
     and ord.orderstate = #{orderstate}
    </if>
    order by ord.addtime desc
  </select>
  
  
  <select id="findByconditions_back" resultMap="BaseResultMap2">
     select 
    ord.id, ord.addtime, ord.userid, ord.ordernumber, ord.cityaddress, ord.detailaddress, ord.receiver, ord.tel, ord.zipcode, 
    ord.orderstate, ord.totalprice, 
    detailorder.id as detailorderid, detailorder.goodsid, detailorder.orderid, detailorder.price, detailorder.count, detailorder.subtotal,
    goods.id as gid, goods.addtime, goods.goodsname, goods.classid, goods.brandid, goods.sellprice, goods.originalprice, goods.Inventory, goods.salevolume, 
    goods.clicks, goods.state, goods.path, goods.volume, goods.weight, goods.goodsnumber, goods.recommend,
    user.id as uid, user.username
    from tb_order ord
    left join tb_detailorder detailorder on detailorder.orderid = ord.id
    left join tb_goods goods on goods.id = detailorder.goodsid
    left join tb_user user on user.id = ord.userid
    where 1=1
	<if test="ordernumber != null and ordernumber != ''">
     and ord.ordernumber = #{ordernumber}
    </if>
    <if test="begintime != null and begintime != ''" >
     and ord.addtime &gt;= #{begintime}
    </if>
    <if test="endtime != null and endtime != ''" >
     and ord.addtime &lt;= "${endtime} 23:59:59"
    </if>
    <if test="orderstate != null and orderstate != ''" >
     and ord.orderstate = #{orderstate}
    </if>
    order by ord.addtime desc
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from tb_order
    where id = #{id,jdbcType=INTEGER}
  </delete>
  
  
	<delete id="deleteOrderById_back">
		delete from tb_order
		where id = #{deleteid}
	</delete>
  
  <insert id="insert" parameterType="com.asjy.commerplat.model.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_order (id, addtime, userid, 
      ordernumber, cityaddress, detailaddress, 
      receiver, tel, zipcode, 
      orderstate, totalprice)
    values (#{id,jdbcType=INTEGER}, #{addtime,jdbcType=TIMESTAMP}, #{userid,jdbcType=INTEGER}, 
      #{ordernumber,jdbcType=VARCHAR}, #{cityaddress,jdbcType=VARCHAR}, #{detailaddress,jdbcType=VARCHAR}, 
      #{receiver,jdbcType=VARCHAR}, #{tel,jdbcType=VARCHAR}, #{zipcode,jdbcType=VARCHAR}, 
      #{orderstate,jdbcType=VARCHAR}, #{totalprice,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.asjy.commerplat.model.Order"  useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="addtime != null" >
        addtime,
      </if>
      <if test="userid != null" >
        userid,
      </if>
      <if test="ordernumber != null" >
        ordernumber,
      </if>
      <if test="cityaddress != null" >
        cityaddress,
      </if>
      <if test="detailaddress != null" >
        detailaddress,
      </if>
      <if test="receiver != null" >
        receiver,
      </if>
      <if test="tel != null" >
        tel,
      </if>
      <if test="zipcode != null" >
        zipcode,
      </if>
      <if test="orderstate != null" >
        orderstate,
      </if>
      <if test="totalprice != null" >
        totalprice,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="addtime != null" >
        #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="userid != null" >
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="ordernumber != null" >
        #{ordernumber,jdbcType=VARCHAR},
      </if>
      <if test="cityaddress != null" >
        #{cityaddress,jdbcType=VARCHAR},
      </if>
      <if test="detailaddress != null" >
        #{detailaddress,jdbcType=VARCHAR},
      </if>
      <if test="receiver != null" >
        #{receiver,jdbcType=VARCHAR},
      </if>
      <if test="tel != null" >
        #{tel,jdbcType=VARCHAR},
      </if>
      <if test="zipcode != null" >
        #{zipcode,jdbcType=VARCHAR},
      </if>
      <if test="orderstate != null" >
        #{orderstate,jdbcType=VARCHAR},
      </if>
      <if test="totalprice != null" >
        #{totalprice,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.asjy.commerplat.model.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_order
    <set >
      <if test="addtime != null" >
        addtime = #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="userid != null" >
        userid = #{userid,jdbcType=INTEGER},
      </if>
      <if test="ordernumber != null" >
        ordernumber = #{ordernumber,jdbcType=VARCHAR},
      </if>
      <if test="cityaddress != null" >
        cityaddress = #{cityaddress,jdbcType=VARCHAR},
      </if>
      <if test="detailaddress != null" >
        detailaddress = #{detailaddress,jdbcType=VARCHAR},
      </if>
      <if test="receiver != null" >
        receiver = #{receiver,jdbcType=VARCHAR},
      </if>
      <if test="tel != null" >
        tel = #{tel,jdbcType=VARCHAR},
      </if>
      <if test="zipcode != null" >
        zipcode = #{zipcode,jdbcType=VARCHAR},
      </if>
      <if test="orderstate != null" >
        orderstate = #{orderstate,jdbcType=VARCHAR},
      </if>
      <if test="totalprice != null" >
        totalprice = #{totalprice,jdbcType=DECIMAL},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.asjy.commerplat.model.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_order
    set addtime = #{addtime,jdbcType=TIMESTAMP},
      userid = #{userid,jdbcType=INTEGER},
      ordernumber = #{ordernumber,jdbcType=VARCHAR},
      cityaddress = #{cityaddress,jdbcType=VARCHAR},
      detailaddress = #{detailaddress,jdbcType=VARCHAR},
      receiver = #{receiver,jdbcType=VARCHAR},
      tel = #{tel,jdbcType=VARCHAR},
      zipcode = #{zipcode,jdbcType=VARCHAR},
      orderstate = #{orderstate,jdbcType=VARCHAR},
      totalprice = #{totalprice,jdbcType=DECIMAL}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  
  <update id="deleteHavePayOrderById" parameterType="com.asjy.commerplat.model.Order" >
   update tb_order
    set 
    orderstate = "用户看不到"
    where id = #{id}
  </update>
</mapper>